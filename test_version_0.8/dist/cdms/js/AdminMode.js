"use strict";define(["pageView"],function(t){var e,a,s=new t.pageFnc,c=s.getCommonFnc(),r=(s.getMemberFnc(),0),n=document;c._setAdd("/cdms");var o=function(){var t="";return t+='<div class="input-group">',t+='<input class="form-control" id="projectName" type="text" placeholder="EDIT Project Name">  ',t+='<span class="input-group-btn">',t+='<button class="btn btn-default" id="editProjectName" type="button"> EDIT',t+="</span></div>",t+='<form class="navbar-form">',t+='<div class="form-group">',t+="</div></form>"},i=function(t,e){var a="";return a+='<div id="subject_'+t+'">',a+='<div class="input-group"><span class="input-group-btn">',a+='<button class="btn btn-default subject_addBtn" id="addSubjects_'+t+'" type="button">',1==t?a+='<span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button></span>':(a+='<span class="glyphicon glyphicon-minus-sign" aria-hidden="true" id="statusMinus_'+t+'"></span>',a+='<span class="glyphicon glyphicon-arrow-right" aria-hidden="true" id="statusNomal_'+t+'"></span>',a+="</button></span>"),a+=_.isObject(e)?'<input class="form-control" id="subjects_'+t+'" type="text" placeholder="Input Subject Name" value='+e.subject+">":'<input class="form-control" id="subjects_'+t+'" type="text" placeholder="Input Subject Name">',a+="</div>",a+='<div class="input-group">',a+=_.isObject(e)?'<input class="form-control" id="countSubjects_'+t+'" type="text" placeholder="How many subjects?" value='+e.count+'><span class="input-group-btn">':'<input class="form-control" id="countSubjects_'+t+'" type="number" placeholder="How many subjects?"><span class="input-group-btn">',a+='<button class="btn btn-default subject_doneBtn" id="subjectsOk_'+t+'" type="button">',a+='<span class="glyphicon glyphicon-ok" aria-hidden="true" id="statusOk_'+t+'"></span>',a+='<span class="glyphicon glyphicon-arrow-down" aria-hidden="true" id="statusNone_'+t+'"></span>',a+="</button>",a+='<button class="btn btn-default subjectsList" id="subjectsList_'+t+'" type="button">',a+='<span class="glyphicon glyphicon-align-justify" aria-hidden="true" id="statusOpen_'+t+'"></span>',a+="</button></span>",a+="</div>",a+="</div>",a+='<div id="chapters_'+t+'">',a+="</div>"},u=function(t,e,a){var s="";s+='<div class="input-group">',s+='<input class="form-control chapterForm" type="text" value="각 차시명을 입력해주세요" readonly="true">',s+='<span class="input-group-btn">',s+='<button class="btn btn-default" id=addChapters_'+e+"_"+t+' type="button"> 수정',s+="</div><br>";for(var c=1;c<=t;c++)console.log("chapter_"+a[c-1]),s+='<div class="input-group">',s+=a[c-1].chapter?'<input class="form-control chapterForm" id="chapter_'+a[c-1]._id+'" type="text" placeholder="each chapter name?"  value="'+a[c-1].chapter+'">':'<input class="form-control chapterForm" id="chapter_'+a[c-1]._id+'" type="text" placeholder="each chapter name?" >',s+="</div><br>";return s},d=function(t){console.log(t);var e="";return e+='<div class="input-group">',e+='<span class="input-group-addon" id="status" >가입상태</span>',e+='<input type="text" id="editStatus" class="form-control" placeholder="Username" aria-describedby="basic-addon1" value='+t.status+">",e+="</div>",e+='<div class="input-group">',e+='<span class="input-group-addon">프로젝트</span>',t.projectNum.length?e+='<input type="text" id="editProjects" class="form-control" placeholder="프로젝트명 입력" aria-describedby="basic-addon1" value='+t.projectNum.toString()+">":e+='<input type="text" id="editProjects" class="form-control" placeholder="프로젝트명 입력" aria-describedby="basic-addon1" >',e+="</div>",e+='<button id="editUserBtn_'+t._id+'" class="btn btn-lg btn-primary btn-block" type="button">수정하기'},l=function(t){for(var e=1;e<=r;++e)$("#subjectsList_"+e).off("click"),$("#subjectsList_"+e).on("click",function(){t.showSubjectList(t)}),1==r?($("#statusNone_"+e).hide(),$("#statusOk_"+e).show()):e==r?($("#addSubjects_"+r).on("click",function(){t.subject_removeBtn(t)}),$("#statusNomal_"+e).hide(),$("#statusMinus_"+e).show(),$("#statusNone_"+e).hide(),$("#statusOk_"+e).show()):($("#statusNomal_"+e).show(),$("#statusMinus_"+e).hide(),$("#statusNone_"+e).show(),$("#statusOk_"+e).hide());$("#addSubjects_1").off("click"),$("#addSubjects_1").on("click",function(){t.subject_addBtn(t)}),$("#subjectsOk_"+r).on("click",function(){t.subjectsOk(t)})};s.setNav({addProject:{name:"addProject",id:"#addProject",_event:"click",type:"POST",async:"true",url:"addProject"},editProject:{name:"editProject",_event:"click",type:"POST",async:"true",url:"editProject"},searchProject:{name:"searchProject",id:"#searchProject",_event:"click",type:"POST",async:"true",url:"searchProject"},subjectsOk:{name:"subjectsOk",_event:"click",type:"POST",async:"true",url:"addSubjects"},showSubjectList:{name:"showSubjectList",_event:"click",type:"POST",async:"true",url:"searchProjectID"},addChapters:{name:"addChapters",_event:"click",type:"POST",async:"true",url:"addChapters"},searchUser:{name:"searchUser",id:"#searchUser",_event:"click",type:"POST",async:"true",url:"searchUser"},editUser:{name:"editUser",_event:"click",type:"POST",async:"true",url:"editUser"}});var p=s.getNav();return s.setObservable({startForm:function(){$("#accordion").accordion({beforeActivate:function(){$("#searchedUserLayer > .navbar-form > .form-group").empty(),$("#searchedLayer").empty(),$(".form-control").val("")},collapsible:!0,heightStyle:"content"})},addChapters:function(t,e){var a=this.addChaptersSet(e);0==a?alert("각각의 주차명을 입력해주세요!"):c.$a(a,p.addChapters)},addChaptersSet:function(t){var e={},s=t.split("_")[1],c=t.split("_")[2],r=document;e.count=c;for(var n,o=1;o<=c;++o){if(""==(n=r.getElementById("chapter_"+a+"_"+s+"_"+o).value))return!1;var i={};i._id=a+"_"+s+"_"+o,i.chapter=n,e["data_"+o]=JSON.stringify(i)}return e},addChaptersDone:function(t){1==t?alert("수정완료"):alert(t)},showSubjectList:function(){var t=event.target.id.split("_")[1],e=$("#chapters_"+t);$("#countSubjects_"+t).val()?document.getElementById("chapters_"+t).hasChildNodes()?(document.getElementById("subjects_"+t).readOnly=!1,document.getElementById("countSubjects_"+t).readOnly=!1,e.empty()):c.$a(this.showSubjectListSet(t),p.showSubjectList):alert("fill in the blanks")},showSubjectListSet:function(t){return{project:a,curTaget:t}},showSubjectListDone:function(t){var e=this;console.log(t.doc);var a=_.size(t.doc);if(0!=a){var s=u(a,t.curTaget,t.doc);document.getElementById("subjects_"+t.curTaget).readOnly=!0,document.getElementById("countSubjects_"+t.curTaget).readOnly=!0,$("#chapters_"+t.curTaget).html(s),$("#addChapters_"+t.curTaget+"_"+a).on("click",function(){e.addChapters(e,event.target.id)})}else console.log("Add subject 1st")},subjectsOk:function(){var t=this.subjectsOkSet();0==t?alert("각각의 차시를 입력해주세요!"):c.$a(t,p.subjectsOk)},subjectsOkSet:function(){for(var t={count:r,project:a},e=1;e<=r;++e){if(""==$("#subjects_"+e).val()||""==$("#countSubjects_"+e).val())return!1;var s={};s._id=a+"_"+e,s.subject=$("#subjects_"+e).val(),s.count=$("#countSubjects_"+e).val(),t["data_"+e]=JSON.stringify(s)}return t},subjectsOkDone:function(t){1==t?alert("수정완료"):alert(t)},subject_addBtn:function(){var t=this;1<r&&$("#addSubjects_"+r).off("click"),$("#subjectsOk_"+r).off("click");var a=i(++r,!1);e.append(a),l(t)},subject_removeBtn:function(){var t=this,e=event.currentTarget.parentNode.parentNode.parentNode.id;--r,$("#"+e).remove(),l(t)},addProject:function(t){event.preventDefault(),c.$a(this.addProjectSet(),p[t])},addProjectSet:function(){return{project:$("#project").val()}},addProjectDone:function(t){console.log(t)},searchProject:function(){event.preventDefault();var t=this.searchProjectSet();0==t?alert("검색어를 입력해주세요"):c.$a(t,p.searchProject)},searchProjectSet:function(){var t=n.getElementById("searchProjects").value;return!!t&&{project:t}},searchProjectDone:function(t){r=0;var s=this;if(null==t.doc)alert("검색되는 프로젝트가 없습니다.");else if(a=t.doc._id,$("#searchedLayer").html(o()),$("#editProjectName").on("click",function(){s.editProject(s,t.doc)}),e=$("#searchedLayer > .navbar-form > .form-group"),$("#projectName").val(t.doc.project),0!=_.size(t.doc.subjects)){r=_.size(t.doc.subjects);var c,n="",u=1;_.forEach(t.doc.subjects,function(t){c=_.defaults({subject:t.subject},{count:t.count});var e=i(u,c);++u,n+=e}),e.html(n),l(s)}else{n=i(++r,!1);e.html(n),l(s)}},searchUser:function(){event.preventDefault();var t=this.searchUsertSet();0==t?alert("검색어를 입력해주세요"):c.$a(t,p.searchUser)},searchUsertSet:function(){var t=n.getElementById("Users").value;return!!t&&{id:t}},searchUserDone:function(t){var e=this;0==t?alert("존재하지 않는 아이디입니다."):($("#searchedUserLayer > .navbar-form > .form-group").html(d(t.doc)),$("#editUserBtn_"+t.doc._id).on("click",function(t){e.editUser(e,t.target.id)}))},editUser:function(t,e){event.preventDefault();var a=this.editUserSet(e);0!=a&&c.$a(a,p.editUser)},editUserSet:function(t){var e=n.getElementById("editStatus").value,a=n.getElementById("editProjects").value;console.log(e);var s=t.split("_")[1];return e?0!=+e&&2!=+e&&3!=+e?(alert("0(대기중),2(관리자) 또는 3(일반) 만 입력해주세요"),!1):a?{_id:s,status:e,projectNum:a}:{_id:s,status:e}:(alert("가입상태값을 기입해주세요"),!1)},editUserDone:function(t){if(1!=t){console.log(t);var e=t.originalItem.toString(),a=t.removeItem;alert(a+" 은(는) 없는 프로젝트입니다."),n.getElementById("editProjects").value=e}else alert("수정완료")},editProject:function(t,e){event.preventDefault();var a=this.editProjectSet(e);a&&c.$a(a,p.editProject)},editProjectSet:function(t){var e=n.getElementById("projectName").value;return e?{_id:t._id,project:e}:(alert("프로젝트명을 입력해주세요"),!1)},editProjectDone:function(t){if(1!=t)alert(t);else{var e=n.getElementById("projectName").value;n.getElementById("searchProjects").value=e,alert("수정완료")}}}),{init:s.init}});